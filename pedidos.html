<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ Agendamentos Realizados</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      VariÃ¡veis CSS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  VariÃ¡veis CSS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
:root {
  --primary:   #0066cc;
  --secondary: #f0f0f0;
  --bg:        #f4f4f4;
  --text:      #333;
  --confirm:   #27ae60;
  --cancel:    #c0392b;
  --pending:   #e67e22;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Reset e Boxâ€Sizing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Base (body, tipografia)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 20px;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Container principal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.container {
  max-width: 1200px;
  margin: 0 auto;
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CabeÃ§alho
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
h2 {
  text-align: center;
  font-size: 1.8rem;
  color: var(--primary);
  margin-bottom: 10px;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Status Counts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
#statusCounts {
  text-align: center;
  margin-bottom: 16px;
  font-weight: bold;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Filtros
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.filter-container {
  text-align: center;
  margin: 20px 0;
}
.filter-container input {
  width: 200px;
  max-width: 45%;
  padding: 8px 12px;
  margin: 0 5px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
  transition: border-color .2s;
}
.filter-container input:focus {
  border-color: var(--primary);
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Tabela (desktop)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.table-wrapper {
  overflow-x: auto;
  margin-bottom: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
}
th, td {
  padding: 12px 15px;
  border: 1px solid #e0e0e0;
  text-align: center;
  font-size: 0.9rem;
}
th {
  background: var(--secondary);
  text-transform: uppercase;
  font-weight: 600;
}
tr:nth-child(even) {
  background: #fafafa;
}
tr:hover {
  background: #f1f1f1;
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Status (cores e estilo)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.status-cell { font-weight: bold; }
.status-pendente   { color: var(--pending); }
.status-confirmado { color: var(--confirm); }
.status-cancelado  { color: var(--cancel); }

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BotÃµes de AÃ§Ã£o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.action-btn {
  padding: 6px 10px;
  font-size: 0.8rem;
  border: none;
  border-radius: 4px;
  color: #fff;
  cursor: pointer;
  transition: background .2s, box-shadow .2s;
  margin: 2px;
}
.confirm-btn       { background: var(--confirm); }
.confirm-btn:hover { background: #219150; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
.cancel-btn-action { background: var(--cancel); }
.cancel-btn-action:hover { background: #992d22; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
.edit-btn          { background: #f39c12; }
.edit-btn:hover    { background: #d78f0f; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
.delete-btn        { background: #dc3545; }
.delete-btn:hover  { background: #c82333; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Modal de ediÃ§Ã£o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
#modalEdit {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  align-items: center;
  justify-content: center;
  padding: 10px;
}
.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  max-width: 400px;
  width: 100%;
}
.modal-content h3 {
  margin-bottom: 12px;
  color: var(--primary);
}
.modal-content label {
  display: block;
  margin-top: 8px;
  font-weight: 600;
}
.modal-content input,
.modal-content select {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
}
.modal-actions {
  margin-top: 16px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
.modal-actions button {
  padding: 8px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.save-btn        { background: var(--confirm); color: #fff; }
.save-btn:hover  { background: #219150; }
.cancel-btn      { background: #bdc3c7; color: #2c3e50; }
.cancel-btn:hover{ background: #a4acb0; }

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Mobile (â‰¤768px): 2-col layout em cada card
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
@media (max-width: 768px) {
  /* filtros empilhados */
  .filter-container input {
    width: 100%;
    margin: 5px 0;
  }

  /* oculta cabeÃ§alho da tabela */
  thead {
    display: none;
  }

  /* cada <tr> vira grid 2-colunas */
  tr {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  /* cada <td> flex com label e valor */
  td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px;
    border: none;
    border-bottom: 1px solid #e0e0e0;
    text-align: left;
  }

  /* label antes do valor */
  td::before {
    content: attr(data-label) ": ";
    font-weight: 600;
    margin-right: 4px;
  }

  /* remove borda do Ãºltimo td */
  td:nth-last-child(1) {
    border-bottom: none;
  }

  /* â€œAÃ§Ãµesâ€ ocupa as 2 colunas */
  td:last-child {
    grid-column: 1 / -1;
    justify-content: flex-start;
  }
}

  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“‹ Agendamentos Realizados</h2>
    <div id="statusCounts">Carregando contagens...</div>
    <div class="filter-container">
      <input id="filterTipo" type="text" placeholder="ğŸ” Filtrar por exameâ€¦">
      <input id="filterData" type="date">
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ClÃ­nica</th>
            <th>Nome</th>
            <th>CPF</th>
            <th>Telefone</th>
            <th>E-mail</th>
            <th>Exame</th>
            <th>Data/Hora Exame</th>
            <th>Local</th>
            <th>Status</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody id="listaAgendamentos">
          <tr><td colspan="10" style="padding:20px">Carregando agendamentos...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div id="modalEdit">
    <div class="modal-content">
      <h3>âœï¸ Editar Agendamento</h3>
      <label>ClÃ­nica</label><input id="editClinica" type="text" placeholder="Digite o nome da clÃ­nica">
      <label>Nome</label><input id="editNome" type="text">
      <label>CPF</label><input id="editCpf" type="text">
      <label>Telefone</label><input id="editTelefone" type="text">
      <label>E-mail</label><input id="editEmail" type="email">
      <label>Tipo de Exame</label>
      <select id="editTipo">
        <option>Hemograma Completo</option>
        <option>Urina Tipo I</option>
        <option>Raio-X Simples</option>
        <option>Ultrassonografia</option>
        <option>Tomografia Computadorizada</option>
        <option>RessonÃ¢ncia MagnÃ©tica</option>
        <option>Eletrocardiograma (ECG)</option>
        <option>Ecocardiograma</option>
        <option>Endoscopia Digestiva</option>
        <option>Colonoscopia</option>
        <option>Mamografia</option>
        <option>Densitometria Ã“ssea</option>
        <option>BiÃ³psia</option>
        <option>Glicemia de Jejum</option>
        <option>Teste de EsforÃ§o</option>
        <option>Perfil LipÃ­dico</option>
        <option>Outros</option>
      </select>
      <label>Data do Exame</label><input id="editDataExame" type="date">
      <label>Hora do Exame</label><input id="editHoraExame" type="time">
      <label>Local do Exame</label><input id="editLocalExame" type="text" placeholder="Digite o local">
      <label>Data de CriaÃ§Ã£o</label><input id="editDataCriacao" type="datetime-local">
      <div class="modal-actions">
        <button class="save-btn" onclick="salvarEdicao()">Salvar</button>
        <button class="cancel-btn" onclick="fecharModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIfTE3Nkwb_yiDKJhmwj_o3I8guislO8g",
      authDomain: "clinica-3f715.firebaseapp.com",
      databaseURL: "https://clinica-3f715-default-rtdb.firebaseio.com",
      projectId: "clinica-3f715",
      storageBucket: "clinica-3f715.firebasestorage.app",
      messagingSenderId: "456473690332",
      appId: "1:456473690332:web:667b239d83c802ecb83419",
      measurementId: "G-7XHX0XC3BD"
    };
    firebase.initializeApp(firebaseConfig);

    const refAgend     = firebase.database().ref('agendamentos');
    const filtroTipo   = document.getElementById('filterTipo');
    const filtroData   = document.getElementById('filterData');
    const tbody        = document.getElementById('listaAgendamentos');
    const statusCounts = document.getElementById('statusCounts');
    const editClinica  = document.getElementById('editClinica');
    const editDataInp  = document.getElementById('editDataExame');
    let agendamentos = [], chaveAtual = null;

    // Bloqueia datas anteriores a hoje
    editDataInp.min = new Date().toISOString().split('T')[0];

    function parseBR(str) {
      if (!str) return new Date(0);
      const [d,t] = str.split(', '),
            [dia,mes,ano] = d.split('/').map(Number),
            [hh,mm] = t.split(':').map(Number);
      return new Date(ano, mes-1, dia, hh, mm);
    }

    function formatBR(dt) {
      const p = n => String(n).padStart(2,'0');
      return `${p(dt.getDate())}/${p(dt.getMonth()+1)}/${p(dt.getFullYear())}, ${p(dt.getHours())}:${p(dt.getMinutes())}`;
    }

    function toLocalISO(dt) {
      const p = n => String(n).padStart(2,'0');
      return `${dt.getFullYear()}-${p(dt.getMonth()+1)}-${p(dt.getDate())}T${p(dt.getHours())}:${p(dt.getMinutes())}`;
    }

    function updateCounts() {
      let pend=0, conf=0, canc=0;
      agendamentos.forEach(a=>{
        if (a.status==='Confirmado') conf++;
        else if (a.status==='Cancelado') canc++;
        else pend++;
      });
      statusCounts.textContent = `Pendentes: ${pend} | Confirmados: ${conf} | Cancelados: ${canc}`;
    }

    function render() {
      tbody.innerHTML = '';
      agendamentos.forEach(a => {
        const sc = a.status==='Confirmado'
          ? 'status-confirmado'
          : a.status==='Cancelado'
            ? 'status-cancelado'
            : 'status-pendente';

        let displayDate = '';
        if (a.dataExame) {
          const [y,m,d] = a.dataExame.split('-');
          displayDate = `${d}/${m}/${y}`;
        }
        const dtText = `${displayDate} ${a.horaExame}`.trim();

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="ClÃ­nica">${a.clinica||''}</td>
          <td data-label="Nome">${a.nome}</td>
          <td data-label="CPF">${a.cpf}</td>
          <td data-label="Telefone">${a.telefone}</td>
          <td data-label="E-mail">${a.email}</td>
          <td data-label="Exame">${a.tipo}</td>
          <td data-label="Data/Hora Exame">${dtText}</td>
          <td data-label="Local">${a.localExame}</td>
          <td data-label="Status" class="status-cell ${sc}">${a.status}</td>
          <td data-label="AÃ§Ãµes">
            <button class="action-btn confirm-btn" onclick="confirmar('${a.key}')">âœ”ï¸</button>
            <button class="action-btn cancel-btn-action" onclick="cancelar('${a.key}')">âŒ</button>
            <button class="action-btn edit-btn" onclick="abrirModal('${a.key}')">âœï¸</button>
            <button class="action-btn delete-btn" onclick="excluirAgendamento('${a.key}')">ğŸ—‘ï¸</button>
          </td>`;
        tbody.appendChild(tr);
      });
      updateCounts();
    }

    refAgend.on('value', snap => {
      agendamentos = [];
      snap.forEach(child => {
        const v = child.val();
        agendamentos.push({
          key: child.key,
          clinica: v.clinica||'',
          nome: v.nome,
          cpf: v.cpf,
          telefone: v.telefone,
          email: v.email,
          tipo: v.tipo,
          dataExame: v.dataExame||'',
          horaExame: v.horaExame||'',
          localExame: v.localExame||'',
          status: v.status||'Pendente'
        });
      });
      render();
    });

    filtroTipo.addEventListener('input', render);
    filtroData.addEventListener('change', render);

    function abrirModal(key) {
      chaveAtual = key;
      const ag = agendamentos.find(a=>a.key===key);
      editClinica.value       = ag.clinica;
      document.getElementById('editNome').value      = ag.nome;
      document.getElementById('editCpf').value       = ag.cpf;
      document.getElementById('editTelefone').value  = ag.telefone;
      document.getElementById('editEmail').value     = ag.email;
      document.getElementById('editTipo').value      = ag.tipo;
      editDataInp.value       = ag.dataExame;
      document.getElementById('editHoraExame').value = ag.horaExame;
      document.getElementById('editLocalExame').value= ag.localExame;
      document.getElementById('editDataCriacao').value = toLocalISO(new Date());
      document.getElementById('modalEdit').style.display = 'flex';
    }

    function salvarEdicao() {
      if (!chaveAtual) return;
      const dt = new Date(document.getElementById('editDataCriacao').value);
      const up = {
        clinica: editClinica.value.trim(),
        nome: document.getElementById('editNome').value.trim(),
        cpf: document.getElementById('editCpf').value.trim(),
        telefone: document.getElementById('editTelefone').value.trim(),
        email: document.getElementById('editEmail').value.trim(),
        tipo: document.getElementById('editTipo').value,
        dataExame: editDataInp.value,
        horaExame: document.getElementById('editHoraExame').value,
        localExame: document.getElementById('editLocalExame').value.trim(),
        criadoEmTimestamp: dt.getTime(),
        criadoEmFormatado: formatBR(dt)
      };
      refAgend.child(chaveAtual).update(up).then(fecharModal);
    }

    function confirmar(key) {
      refAgend.child(key).update({ status:'Confirmado' }).then(()=>{
        const ag = agendamentos.find(a=>a.key===key);
        let displayDate='';
        if(ag.dataExame){
          const [y,m,d]=ag.dataExame.split('-');
          displayDate=`${d}/${m}/${y}`;
        }
        const displayDateTime = `${displayDate} ${ag.horaExame}`.trim();
        const msg =
          `ğŸ©º *ConfirmaÃ§Ã£o de Exame* ğŸ©º\n\n` +
         
          `ğŸ‘¤ *Nome:* ${ag.nome}\n` +
          `ğŸ†” *CPF:* ${ag.cpf}\n` +
          `âœ‰ï¸ *E-mail:* ${ag.email}\n` +
          `ğŸ“± *Telefone:* ${ag.telefone}\n\n` +
           `ğŸ¥ *ClÃ­nica:* ${ag.clinica}\n` +
          `âœ… *Exame:* ${ag.tipo}\n` +
          `ğŸ—“ï¸ *Data/Hora:* ${displayDateTime}\n` +
          `ğŸ“ *Local:* ${ag.localExame}\n\n` +
          `AtÃ© breve!`;
        const tel = ag.telefone.replace(/\D/g,'');
        window.open(
          `https://api.whatsapp.com/send?phone=55${tel}&text=${encodeURIComponent(msg)}`,
          '_blank'
        );
      });
    }

    function cancelar(key) { refAgend.child(key).update({ status:'Cancelado' }); }
    function excluirAgendamento(key) { if(confirm('Deseja realmente excluir este agendamento?')) refAgend.child(key).remove(); }
    function fecharModal() { document.getElementById('modalEdit').style.display='none'; chaveAtual=null; }

    firebase.auth().onAuthStateChanged(u=>{ if(!u) location.href='login.html'; });
  </script>
</body>
</html>
